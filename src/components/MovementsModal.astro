---
import { actions } from 'astro:actions'
const { data: accounts, error } = await Astro.callAction(actions.getAccounts, '')
if (!accounts || error) {
  console.error('Error fetching accounts:', error)
  throw new Error('Failed to fetch accounts')
}
---

<dialog
  id="movements-modal"
  class="bg-transparent w-full self-center mx-auto max-w-3xl"
>
  <main
    class="border border-red-600 rounded-lg p-6 shadow-lg bg-gray-900 backdrop-blur-3xl"
  >
    <h2 class="text-xl font-semibold mb-4">Movements</h2>
    <form
      action="/movements"
      method="post"
      class="flex flex-col space-y-4"
    >
      <label>
        <span>Amount</span>
        <input
          type="number"
          name="amount"
          autofocus
          required
        />
      </label>
      <label>
        <span>Description</span>
        <input
          type="text"
          name="description"
          required
        />
      </label>
      <label>
        <span>Type</span>
        <select
          name="type"
          required
        >
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>
      </label>
      <label>
        <span>Date</span>
        <input
          type="date"
          name="date"
          required
        />
      </label>
      <label>
        <span>Accounts</span>
      </label>
      <select
        name="accounts"
        required
      >
        {accounts.map((account) => <option value={account.id}>{account.name}</option>)}
      </select>
      <div class="flex justify-around items-center mt-4 gap-4">
        <button
          type="button"
          commandfor="movements-modal"
          command="close"
          class="px-4 py-2 bg-slate-700/90 rounded w-full hover:bg-slate-700 cursor-pointer"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="px-4 py-2 bg-blue-600/85 rounded w-full hover:bg-blue-600 cursor-pointer"
        >
          Add Movement
        </button>
      </div>
    </form>
  </main>
</dialog>

<style>
  main {
    animation: fade-in 100ms ease-in-out;
    color: #fafafa;
  }
  main input,
  select {
    width: 100%;
    padding: 4px 12px;
    background: #1e2939;
    border-radius: 6px;
    outline: none;
  }
  input:focus,
  select:focus {
    border: solid 1px #3b82f6;
  }
  span {
    color: #d1d5dc;
  }
  @keyframes fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
</style>
